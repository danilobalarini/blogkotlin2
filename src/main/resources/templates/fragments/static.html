<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<body>

	<div th:fragment="about" class="post-wrapper">
		<div class="post-content">
			<div class="body-copy w-richtext">
				<h1>About me</h1>
				<p>The rich text element allows you to create and format headings, paragraphs, blockquotes, images, and video all in one place instead of having to add and format them individually. Just double-click and easily create content.</p>
				<h2>Something else here</h2>
				<p>Maecenas faucibus mollis interdum. Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor. Curabitur blandit tempus porttitor. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum id ligula porta felis euismod semper.</p>
				<p>Vestibulum id ligula porta felis euismod semper. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec id elit non mi porta gravida at eget metus. Donec ullamcorper nulla non metus auctor fringilla.</p>
			</div>
			<a class="button w-button" href="http://denali-template.webflow.io/contact">Get in touch</a>
		</div>
	</div>

	<div th:fragment="contact" class="post-wrapper">
		<script th:src="|https://www.google.com/recaptcha/api.js?render=${keysite}"></script>
		<div class="post-content">
			<div class="body-copy w-richtext">
				<h1>Entre em contato</h1>
			</div>
			
			<div class="form-wrapper">
				
				<form id="email-form" data-name="Email Form" name="email-form">
					<label for="Name">Nome</label>
					<input class="text-field w-input" data-name="Name" id="txtName" maxlength="256" name="txtName" placeholder="Digite seu nome" type="text">
					<label for="Email">E-Mail</label>
					<input class="text-field w-input" data-name="Email" id="txtEmail" maxlength="256" name="txtEmail" placeholder="Digite seu endereÃ§o de e-mail" required="required" type="email">
					<label for="Message">Mensagem</label>
					<textarea class="text-area text-field w-input" data-name="Message" id="txtMessage" maxlength="5000" name="txtMessage" placeholder="Digite a mensagem" required="required"></textarea>
					<input id="btnSubmit" class="button w-button" data-wait="Please wait..." type="button" value="Submit">
				</form>

				<div id="divSuccess" class="success-message w-form-done">
					<p class="success-text">Muito Obrigado! Sua mensagem foi enviada!</p>
					<span id="spanTimeout"></span>
				</div>
								
				<div id="divFailure" class="w-form-fail">
					<p>Ooopa! Aconteceu algo errado no envio da mensagem.</p>
				</div>

				<script th:inline="javascript">

					$(document).ready(function() {
						
						var keysite = [[${keysite}]];
						var register_action = [[${registerAction}]];

						$('#btnSubmit').click(function() {
							console.log('keysite: ' + keysite);
							console.log('typeof grecaptcha: ' + typeof grecaptcha !== 'undefined');
							
							grecaptcha.execute(keysite, {action : register_action}).then(function(response) { 
								
								var facade = {
									name:$('#txtName').val(),
									email:$('#txtEmail').val(),
									message:$('#txtMessage').val(),
									response:response
								}
						
								console.log('form data: ' + JSON.stringify(facade));

								$.ajax({
									url: "/getContact",
									type: "POST",
									data: JSON.stringify(facade),
									contentType: "application/json; charset=utf-8",
									cache: false,
									processData: false,
									success: function (data) {
										redirect(data);
									},
									error : function(jqXHR, textStatus, errorThrown) {
										console.log("jqXHR: " + jqXHR.status);
										console.log("textStatus: " + textStatus);
										console.log("errorThrown: " + errorThrown);
									}
								});

							});
						});

						function redirect(data) {
							console.log("resposta: " + data)
							console.log("tudo certo!!!");
							$('#divSuccess').show();
							var i=10;
							setInterval(function () {
								$("#spanTimeout").html(i);
								i--;
							}, 3000)
							window.location.href = "/contact";
						}

					});
				</script>
			</div>
		</div>
	</div>

</body>
</html>